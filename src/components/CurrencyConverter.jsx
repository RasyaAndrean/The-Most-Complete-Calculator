import { useCallback, useEffect, useRef, useState } from 'react';
import { FavoritesButton } from './FavoritesButton.jsx';

function SimpleButton({ children, onClick, className = '', title = '' }) {
  return (
    <button
      onClick={onClick}
      className={`px-4 py-2 rounded border ${className}`}
      title={title}
    >
      {children}
    </button>
  );
}

function InputField({
  label,
  value,
  onChange,
  placeholder = '',
  type = 'number',
  unit = '',
}) {
  return (
    <div className="mb-4">
      <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
        {label}
      </label>
      <div className="relative">
        <input
          type={type}
          value={value}
          onChange={e => onChange(e.target.value)}
          placeholder={placeholder}
          className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 pr-12"
        />
        {unit && (
          <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
            {unit}
          </div>
        )}
      </div>
    </div>
  );
}

function SelectField({ label, value, onChange, options }) {
  return (
    <div className="mb-4">
      <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
        {label}
      </label>
      <select
        value={value}
        onChange={e => onChange(e.target.value)}
        className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"
      >
        {options.map(option => (
          <option key={option.value} value={option.value}>
            {option.label}
          </option>
        ))}
      </select>
    </div>
  );
}

function ResultDisplay({ label, value, unit = '', className = '' }) {
  return (
    <div
      className={`bg-blue-50 dark:bg-blue-900 p-4 rounded border ${className}`}
    >
      <div className="text-sm font-medium text-gray-700 dark:text-gray-300">
        {label}
      </div>
      <div className="text-xl font-bold text-blue-600 dark:text-blue-400">
        {typeof value === 'number'
          ? value.toLocaleString('id-ID', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })
          : value}{' '}
        {unit}
      </div>
    </div>
  );
}

export function CurrencyConverter() {
  const [amount, setAmount] = useState('1');
  const [fromCurrency, setFromCurrency] = useState('USD');
  const [toCurrency, setToCurrency] = useState('IDR');
  const [result, setResult] = useState(null);
  const [lastUpdated, setLastUpdated] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [exchangeRates, setExchangeRates] = useState({});
  const [supportedCurrencies, setSupportedCurrencies] = useState([]);
  const conversionTimeoutRef = useRef(null);

  // Comprehensive list of currencies with additional information
  const currencyData = {
    USD: { name: 'US Dollar', country: 'United States', flag: 'ğŸ‡ºğŸ‡¸' },
    EUR: { name: 'Euro', country: 'European Union', flag: 'ğŸ‡ªğŸ‡º' },
    GBP: { name: 'British Pound', country: 'United Kingdom', flag: 'ğŸ‡¬ğŸ‡§' },
    JPY: { name: 'Japanese Yen', country: 'Japan', flag: 'ğŸ‡¯ğŸ‡µ' },
    IDR: { name: 'Indonesian Rupiah', country: 'Indonesia', flag: 'ğŸ‡®ğŸ‡©' },
    AUD: { name: 'Australian Dollar', country: 'Australia', flag: 'ğŸ‡¦ğŸ‡º' },
    CAD: { name: 'Canadian Dollar', country: 'Canada', flag: 'ğŸ‡¨ğŸ‡¦' },
    CHF: { name: 'Swiss Franc', country: 'Switzerland', flag: 'ğŸ‡¨ğŸ‡­' },
    CNY: { name: 'Chinese Yuan', country: 'China', flag: 'ğŸ‡¨ğŸ‡³' },
    SGD: { name: 'Singapore Dollar', country: 'Singapore', flag: 'ğŸ‡¸ğŸ‡¬' },
    INR: { name: 'Indian Rupee', country: 'India', flag: 'ğŸ‡®ğŸ‡³' },
    KRW: { name: 'South Korean Won', country: 'South Korea', flag: 'ğŸ‡°ğŸ‡·' },
    MYR: { name: 'Malaysian Ringgit', country: 'Malaysia', flag: 'ğŸ‡²ğŸ‡¾' },
    THB: { name: 'Thai Baht', country: 'Thailand', flag: 'ğŸ‡¹ğŸ‡­' },
    PHP: { name: 'Philippine Peso', country: 'Philippines', flag: 'ğŸ‡µğŸ‡­' },
    VND: { name: 'Vietnamese Dong', country: 'Vietnam', flag: 'ğŸ‡»ğŸ‡³' },
    HKD: { name: 'Hong Kong Dollar', country: 'Hong Kong', flag: 'ğŸ‡­ğŸ‡°' },
    NZD: { name: 'New Zealand Dollar', country: 'New Zealand', flag: 'ğŸ‡³ğŸ‡¿' },
    MXN: { name: 'Mexican Peso', country: 'Mexico', flag: 'ğŸ‡²ğŸ‡½' },
    BRL: { name: 'Brazilian Real', country: 'Brazil', flag: 'ğŸ‡§ğŸ‡·' },
    RUB: { name: 'Russian Ruble', country: 'Russia', flag: 'ğŸ‡·ğŸ‡º' },
    TRY: { name: 'Turkish Lira', country: 'Turkey', flag: 'ğŸ‡¹ğŸ‡·' },
    ZAR: { name: 'South African Rand', country: 'South Africa', flag: 'ğŸ‡¿ğŸ‡¦' },
    SEK: { name: 'Swedish Krona', country: 'Sweden', flag: 'ğŸ‡¸ğŸ‡ª' },
    NOK: { name: 'Norwegian Krone', country: 'Norway', flag: 'ğŸ‡³ğŸ‡´' },
    DKK: { name: 'Danish Krone', country: 'Denmark', flag: 'ğŸ‡©ğŸ‡°' },
    PLN: { name: 'Polish Zloty', country: 'Poland', flag: 'ğŸ‡µğŸ‡±' },
    CZK: { name: 'Czech Koruna', country: 'Czech Republic', flag: 'ğŸ‡¨ğŸ‡¿' },
    HUF: { name: 'Hungarian Forint', country: 'Hungary', flag: 'ğŸ‡­ğŸ‡º' },
    ILS: { name: 'Israeli Shekel', country: 'Israel', flag: 'ğŸ‡®ğŸ‡±' },
    ARS: { name: 'Argentine Peso', country: 'Argentina', flag: 'ğŸ‡¦ğŸ‡·' },
    CLP: { name: 'Chilean Peso', country: 'Chile', flag: 'ğŸ‡¨ğŸ‡±' },
    PEN: { name: 'Peruvian Sol', country: 'Peru', flag: 'ğŸ‡µğŸ‡ª' },
    COP: { name: 'Colombian Peso', country: 'Colombia', flag: 'ğŸ‡¨ğŸ‡´' },
    AED: { name: 'UAE Dirham', country: 'United Arab Emirates', flag: 'ğŸ‡¦ğŸ‡ª' },
    SAR: { name: 'Saudi Riyal', country: 'Saudi Arabia', flag: 'ğŸ‡¸ğŸ‡¦' },
    QAR: { name: 'Qatari Riyal', country: 'Qatar', flag: 'ğŸ‡¶ğŸ‡¦' },
    KWD: { name: 'Kuwaiti Dinar', country: 'Kuwait', flag: 'ğŸ‡°ğŸ‡¼' },
    BHD: { name: 'Bahraini Dinar', country: 'Bahrain', flag: 'ğŸ‡§ğŸ‡­' },
    OMR: { name: 'Omani Rial', country: 'Oman', flag: 'ğŸ‡´ğŸ‡²' },
    JOD: { name: 'Jordanian Dinar', country: 'Jordan', flag: 'ğŸ‡¯ğŸ‡´' },
    LBP: { name: 'Lebanese Pound', country: 'Lebanon', flag: 'ğŸ‡±ğŸ‡§' },
    EGP: { name: 'Egyptian Pound', country: 'Egypt', flag: 'ğŸ‡ªğŸ‡¬' },
    NGN: { name: 'Nigerian Naira', country: 'Nigeria', flag: 'ğŸ‡³ğŸ‡¬' },
    KES: { name: 'Kenyan Shilling', country: 'Kenya', flag: 'ğŸ‡°ğŸ‡ª' },
    GHS: { name: 'Ghanaian Cedi', country: 'Ghana', flag: 'ğŸ‡¬ğŸ‡­' },
    UGX: { name: 'Ugandan Shilling', country: 'Uganda', flag: 'ğŸ‡ºğŸ‡¬' },
    TZS: { name: 'Tanzanian Shilling', country: 'Tanzania', flag: 'ğŸ‡¹ğŸ‡¿' },
    MAD: { name: 'Moroccan Dirham', country: 'Morocco', flag: 'ğŸ‡²ğŸ‡¦' },
    TND: { name: 'Tunisian Dinar', country: 'Tunisia', flag: 'ğŸ‡¹ğŸ‡³' },
    BDT: { name: 'Bangladeshi Taka', country: 'Bangladesh', flag: 'ğŸ‡§ğŸ‡©' },
    PKR: { name: 'Pakistani Rupee', country: 'Pakistan', flag: 'ğŸ‡µğŸ‡°' },
    LKR: { name: 'Sri Lankan Rupee', country: 'Sri Lanka', flag: 'ğŸ‡±ğŸ‡°' },
    NPR: { name: 'Nepalese Rupee', country: 'Nepal', flag: 'ğŸ‡³ğŸ‡µ' },
    UAH: { name: 'Ukrainian Hryvnia', country: 'Ukraine', flag: 'ğŸ‡ºğŸ‡¦' },
    RON: { name: 'Romanian Leu', country: 'Romania', flag: 'ğŸ‡·ğŸ‡´' },
    BGN: { name: 'Bulgarian Lev', country: 'Bulgaria', flag: 'ğŸ‡§ğŸ‡¬' },
    HRK: { name: 'Croatian Kuna', country: 'Croatia', flag: 'ğŸ‡­ğŸ‡·' },
    DZD: { name: 'Algerian Dinar', country: 'Algeria', flag: 'ğŸ‡©ğŸ‡¿' },
    IQD: { name: 'Iraqi Dinar', country: 'Iraq', flag: 'ğŸ‡®ğŸ‡¶' },
    AFN: { name: 'Afghan Afghani', country: 'Afghanistan', flag: 'ğŸ‡¦ğŸ‡«' },
    ALL: { name: 'Albanian Lek', country: 'Albania', flag: 'ğŸ‡¦ğŸ‡±' },
    DOP: { name: 'Dominican Peso', country: 'Dominican Republic', flag: 'ğŸ‡©ğŸ‡´' },
    ETB: { name: 'Ethiopian Birr', country: 'Ethiopia', flag: 'ğŸ‡ªğŸ‡¹' },
    GEL: { name: 'Georgian Lari', country: 'Georgia', flag: 'ğŸ‡¬ğŸ‡ª' },
    HNL: { name: 'Honduran Lempira', country: 'Honduras', flag: 'ğŸ‡­ğŸ‡³' },
    ISK: { name: 'Icelandic KrÃ³na', country: 'Iceland', flag: 'ğŸ‡®ğŸ‡¸' },
    JMD: { name: 'Jamaican Dollar', country: 'Jamaica', flag: 'ğŸ‡¯ğŸ‡²' },
    KGS: { name: 'Kyrgyzstani Som', country: 'Kyrgyzstan', flag: 'ğŸ‡°ğŸ‡¬' },
    KHR: { name: 'Cambodian Riel', country: 'Cambodia', flag: 'ğŸ‡°ğŸ‡­' },
    KPW: { name: 'North Korean Won', country: 'North Korea', flag: 'ğŸ‡°ğŸ‡µ' },
    KZT: { name: 'Kazakhstani Tenge', country: 'Kazakhstan', flag: 'ğŸ‡°ğŸ‡¿' },
    LAK: { name: 'Lao Kip', country: 'Laos', flag: 'ğŸ‡±ğŸ‡¦' },
    LRD: { name: 'Liberian Dollar', country: 'Liberia', flag: 'ğŸ‡±ğŸ‡·' },
    LYD: { name: 'Libyan Dinar', country: 'Libya', flag: 'ğŸ‡±ğŸ‡¾' },
    MDL: { name: 'Moldovan Leu', country: 'Moldova', flag: 'ğŸ‡²ğŸ‡©' },
    MKD: { name: 'Macedonian Denar', country: 'North Macedonia', flag: 'ğŸ‡²ğŸ‡°' },
    MMK: { name: 'Myanmar Kyat', country: 'Myanmar', flag: 'ğŸ‡²ğŸ‡²' },
    MNT: { name: 'Mongolian TÃ¶grÃ¶g', country: 'Mongolia', flag: 'ğŸ‡²ğŸ‡³' },
    MOP: { name: 'Macanese Pataca', country: 'Macau', flag: 'ğŸ‡²ğŸ‡´' },
    MUR: { name: 'Mauritian Rupee', country: 'Mauritius', flag: 'ğŸ‡²ğŸ‡º' },
    MVR: { name: 'Maldivian Rufiyaa', country: 'Maldives', flag: 'ğŸ‡²ğŸ‡»' },
    MWK: { name: 'Malawian Kwacha', country: 'Malawi', flag: 'ğŸ‡²ğŸ‡¼' },
    MZN: { name: 'Mozambican Metical', country: 'Mozambique', flag: 'ğŸ‡²ğŸ‡¿' },
    NAD: { name: 'Namibian Dollar', country: 'Namibia', flag: 'ğŸ‡³ğŸ‡¦' },
    NIO: { name: 'Nicaraguan CÃ³rdoba', country: 'Nicaragua', flag: 'ğŸ‡³ğŸ‡®' },
    PGK: {
      name: 'Papua New Guinean Kina',
      country: 'Papua New Guinea',
      flag: 'ğŸ‡µğŸ‡¬',
    },
    PYG: { name: 'Paraguayan Guarani', country: 'Paraguay', flag: 'ğŸ‡µğŸ‡¾' },
    RSD: { name: 'Serbian Dinar', country: 'Serbia', flag: 'ğŸ‡·ğŸ‡¸' },
    RWF: { name: 'Rwandan Franc', country: 'Rwanda', flag: 'ğŸ‡·ğŸ‡¼' },
    SBD: {
      name: 'Solomon Islands Dollar',
      country: 'Solomon Islands',
      flag: 'ğŸ‡¸ğŸ‡§',
    },
    SCR: { name: 'Seychellois Rupee', country: 'Seychelles', flag: 'ğŸ‡¸ğŸ‡¨' },
    SDG: { name: 'Sudanese Pound', country: 'Sudan', flag: 'ğŸ‡¸ğŸ‡©' },
    SHP: { name: 'Saint Helena Pound', country: 'Saint Helena', flag: 'ğŸ‡¸ğŸ‡­' },
    SLL: { name: 'Sierra Leonean Leone', country: 'Sierra Leone', flag: 'ğŸ‡¸ğŸ‡±' },
    SOS: { name: 'Somali Shilling', country: 'Somalia', flag: 'ğŸ‡¸ğŸ‡´' },
    SRD: { name: 'Surinamese Dollar', country: 'Suriname', flag: 'ğŸ‡¸ğŸ‡·' },
    SSP: { name: 'South Sudanese Pound', country: 'South Sudan', flag: 'ğŸ‡¸ğŸ‡¸' },
    STN: {
      name: 'SÃ£o TomÃ© and PrÃ­ncipe Dobra',
      country: 'SÃ£o TomÃ© and PrÃ­ncipe',
      flag: 'ğŸ‡¸ğŸ‡¹',
    },
    SYP: { name: 'Syrian Pound', country: 'Syria', flag: 'ğŸ‡¸ğŸ‡¾' },
    SZL: { name: 'Swazi Lilangeni', country: 'Eswatini', flag: 'ğŸ‡¸ğŸ‡¿' },
    TJS: { name: 'Tajikistani Somoni', country: 'Tajikistan', flag: 'ğŸ‡¹ğŸ‡¯' },
    TMT: { name: 'Turkmenistan Manat', country: 'Turkmenistan', flag: 'ğŸ‡¹ğŸ‡²' },
    TOP: { name: 'Tongan PaÊ»anga', country: 'Tonga', flag: 'ğŸ‡¹ğŸ‡´' },
    TTD: {
      name: 'Trinidad and Tobago Dollar',
      country: 'Trinidad and Tobago',
      flag: 'ğŸ‡¹ğŸ‡¹',
    },
    TWD: { name: 'New Taiwan Dollar', country: 'Taiwan', flag: 'ğŸ‡¹ğŸ‡¼' },
    UYU: { name: 'Uruguayan Peso', country: 'Uruguay', flag: 'ğŸ‡ºğŸ‡¾' },
    UZS: { name: 'Uzbekistani Som', country: 'Uzbekistan', flag: 'ğŸ‡ºğŸ‡¿' },
    VES: { name: 'Venezuelan BolÃ­var', country: 'Venezuela', flag: 'ğŸ‡»ğŸ‡ª' },
    VUV: { name: 'Vanuatu Vatu', country: 'Vanuatu', flag: 'ğŸ‡»ğŸ‡º' },
    WST: { name: 'Samoan Tala', country: 'Samoa', flag: 'ğŸ‡¼ğŸ‡¸' },
    XAF: {
      name: 'Central African CFA Franc',
      country: 'Central African Republic',
      flag: 'ğŸ‡¨ğŸ‡«',
    },
    XCD: {
      name: 'East Caribbean Dollar',
      country: 'Organisation of Eastern Caribbean States',
      flag: 'ğŸ‡¨ğŸ‡¼',
    },
    XOF: { name: 'West African CFA Franc', country: 'West Africa', flag: 'ğŸ‡¸ğŸ‡³' },
    XPF: { name: 'CFP Franc', country: 'French Polynesia', flag: 'ğŸ‡µğŸ‡«' },
    YER: { name: 'Yemeni Rial', country: 'Yemen', flag: 'ğŸ‡¾ğŸ‡ª' },
    ZMW: { name: 'Zambian Kwacha', country: 'Zambia', flag: 'ğŸ‡¿ğŸ‡²' },
    ZWL: { name: 'Zimbabwean Dollar', country: 'Zimbabwe', flag: 'ğŸ‡¿ğŸ‡¼' },
  };

  // Generate currency options from currencyData
  const currencyOptions = Object.keys(currencyData).map(code => ({
    value: code,
    label: `${code} - ${currencyData[code].name} ${currencyData[code].flag}`,
  }));

  // Fetch exchange rates from API
  const fetchExchangeRates = useCallback(async (baseCurrency = 'USD') => {
    setLoading(true);
    setError(null);

    try {
      // Using exchangerate-api.com (free tier)
      const response = await fetch(
        `https://api.exchangerate-api.com/v4/latest/${baseCurrency}`
      );

      if (!response.ok) {
        throw new Error('Gagal mengambil data kurs');
      }

      const data = await response.json();

      setExchangeRates(data.rates);
      setLastUpdated(new Date(data.date).toLocaleString('id-ID'));

      // Set supported currencies
      setSupportedCurrencies(Object.keys(data.rates));
    } catch (err) {
      console.error('Error fetching exchange rates:', err);
      setError('Gagal mengambil data kurs. Menggunakan data statis.');

      // Fallback to static rates
      const staticExchangeRates = {
        USD: 1,
        EUR: 0.93,
        GBP: 0.79,
        JPY: 147.5,
        IDR: 15800,
        AUD: 1.52,
        CAD: 1.36,
        CHF: 0.91,
        CNY: 7.24,
        SGD: 1.35,
        INR: 83.3,
        KRW: 1350,
        MYR: 4.7,
        THB: 36.5,
        PHP: 57.5,
        VND: 24500,
        HKD: 7.83,
        NZD: 1.66,
        MXN: 17.8,
        BRL: 5.2,
        RUB: 92.5,
        TRY: 27.5,
        ZAR: 18.8,
        SEK: 10.7,
        NOK: 10.9,
        DKK: 6.9,
        PLN: 3.9,
        CZK: 22.8,
        HUF: 358,
        ILS: 3.7,
        ARS: 830,
        CLP: 915,
        PEN: 3.8,
        COP: 4100,
        AED: 3.67,
        SAR: 3.75,
        QAR: 3.64,
        KWD: 0.31,
        BHD: 0.38,
        OMR: 0.38,
        JOD: 0.71,
        LBP: 89500,
        EGP: 30.9,
        NGN: 1520,
        KES: 133,
        GHS: 12.5,
        UGX: 3750,
        TZS: 2650,
        MAD: 10.2,
        TND: 3.1,
        BDT: 117,
        PKR: 277,
        LKR: 298,
        NPR: 133,
        UAH: 36.9,
        RON: 4.5,
        BGN: 1.8,
        HRK: 7.0,
        DZD: 134,
        IQD: 1310,
        AFN: 72,
        ALL: 98,
        DOP: 58,
        ETB: 57,
        GEL: 2.7,
        HNL: 24.7,
        ISK: 138,
        JMD: 155,
        KGS: 89,
        KHR: 4100,
        KPW: 900,
        KZT: 457,
        LAK: 21000,
        LRD: 197,
        LYD: 4.8,
        MDL: 17.7,
        MKD: 56,
        MMK: 2100,
        MNT: 3400,
        MOP: 8.1,
        MUR: 44,
        MVR: 15.4,
        MWK: 1050,
        MZN: 64,
        NAD: 18.5,
        NIO: 36.5,
        PYG: 7500,
        RSD: 108,
        RWF: 1200,
        SBD: 8.3,
        SCR: 13.3,
        SDG: 600,
        SHP: 0.78,
        SLL: 22000,
        SOS: 575,
        SRD: 38,
        SSP: 800,
        STN: 22.5,
        SYP: 2500,
        SZL: 18.5,
        TJS: 11.2,
        TMT: 3.5,
        TOP: 2.3,
        TTD: 6.8,
        TWD: 31.5,
        UYU: 38.5,
        UZS: 12500,
        VES: 35.5,
        VUV: 118,
        WST: 2.7,
        XAF: 600,
        XCD: 2.7,
        XOF: 600,
        XPF: 110,
        YER: 250,
        ZMW: 25.5,
        ZWL: 322,
      };

      setExchangeRates(staticExchangeRates);
      setLastUpdated(new Date().toLocaleString('id-ID'));
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    // Initialize with exchange rates
    fetchExchangeRates(fromCurrency);
  }, [fetchExchangeRates, fromCurrency]);

  const swapCurrencies = () => {
    setFromCurrency(toCurrency);
    setToCurrency(fromCurrency);
  };

  const convertCurrency = useCallback(() => {
    const amountValue = parseFloat(amount);

    if (isNaN(amountValue) || amountValue <= 0) {
      setError('Masukkan jumlah yang valid');
      return;
    }

    if (!exchangeRates[fromCurrency] || !exchangeRates[toCurrency]) {
      setError('Mata uang tidak didukung');
      return;
    }

    try {
      // Convert to target currency
      const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
      const convertedAmount = amountValue * rate;

      setResult({
        convertedAmount: convertedAmount.toFixed(2),
        rate: rate.toFixed(6),
        amount: amountValue,
        inverseRate: (1 / rate).toFixed(6),
      });
    } catch (err) {
      setError('Terjadi kesalahan dalam konversi');
    }
  }, [amount, fromCurrency, toCurrency, exchangeRates]);

  // Convert when inputs change with debounce
  useEffect(() => {
    // Clear previous timeout
    if (conversionTimeoutRef.current) {
      clearTimeout(conversionTimeoutRef.current);
    }

    // Set new timeout
    conversionTimeoutRef.current = setTimeout(() => {
      if (
        amount &&
        fromCurrency &&
        toCurrency &&
        Object.keys(exchangeRates).length > 0
      ) {
        convertCurrency();
      }
    }, 500); // 500ms debounce

    // Cleanup timeout on unmount
    return () => {
      if (conversionTimeoutRef.current) {
        clearTimeout(conversionTimeoutRef.current);
      }
    };
  }, [amount, fromCurrency, toCurrency, exchangeRates, convertCurrency]);

  // Function to format currency with proper symbol and formatting
  const formatCurrency = (amount, currencyCode) => {
    // Special formatting for certain currencies
    const currencyFormats = {
      JPY: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
      IDR: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
      VND: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
      KRW: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
      KPW: { minimumFractionDigits: 0, maximumFractionDigits: 0 },
      KWD: { minimumFractionDigits: 3, maximumFractionDigits: 3 },
      BHD: { minimumFractionDigits: 3, maximumFractionDigits: 3 },
      OMR: { minimumFractionDigits: 3, maximumFractionDigits: 3 },
      JOD: { minimumFractionDigits: 3, maximumFractionDigits: 3 },
    };

    const format = currencyFormats[currencyCode] || {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    };

    return new Intl.NumberFormat('id-ID', {
      ...format,
      style: 'currency',
      currency: currencyCode,
    }).format(amount);
  };

  return (
    <div className="max-w-4xl mx-auto">
      <div className="mb-4 flex justify-between items-center">
        <h3 className="text-xl font-semibold text-gray-800 dark:text-white">
          Konversi Mata Uang (Real-time)
        </h3>
        <FavoritesButton calculatorId="currency" calculatorName="Currency Converter" />
      </div>

      <div className="bg-white dark:bg-gray-800 p-6 rounded-lg border mb-6">
        <div className="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
          <div className="md:col-span-2">
            <InputField
              label="Jumlah"
              value={amount}
              onChange={setAmount}
              placeholder="Masukkan jumlah"
              unit={fromCurrency}
            />
          </div>

          <div className="md:col-span-1 flex items-end justify-center">
            <SimpleButton
              onClick={swapCurrencies}
              className="bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 h-10 w-10 rounded-full flex items-center justify-center"
              title="Tukar Mata Uang"
            >
              â‡„
            </SimpleButton>
          </div>

          <div className="md:col-span-1">
            <SelectField
              label="Dari"
              value={fromCurrency}
              onChange={setFromCurrency}
              options={currencyOptions.filter(
                option =>
                  supportedCurrencies.length === 0 ||
                  supportedCurrencies.includes(option.value)
              )}
            />
          </div>

          <div className="md:col-span-1">
            <SelectField
              label="Ke"
              value={toCurrency}
              onChange={setToCurrency}
              options={currencyOptions.filter(
                option =>
                  supportedCurrencies.length === 0 ||
                  supportedCurrencies.includes(option.value)
              )}
            />
          </div>
        </div>

        {loading && (
          <div className="text-center py-4">
            <div className="inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"></div>
            <p className="mt-2 text-gray-600 dark:text-gray-400">
              Mengambil data kurs terbaru...
            </p>
          </div>
        )}

        {error && (
          <div className="bg-red-50 dark:bg-red-900 p-4 rounded border mb-4">
            <div className="text-red-600 dark:text-red-400">{error}</div>
          </div>
        )}

        {result && !loading && (
          <div className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <ResultDisplay
                label={`Hasil (${toCurrency})`}
                value={parseFloat(result.convertedAmount)}
                className="md:col-span-2"
              />
              <ResultDisplay
                label="Kurs"
                value={`1 ${fromCurrency} = ${result.rate} ${toCurrency}`}
              />
              <ResultDisplay
                label="Kurs Terbalik"
                value={`1 ${toCurrency} = ${result.inverseRate} ${fromCurrency}`}
              />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
              <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded border">
                <div className="text-sm font-medium text-gray-700 dark:text-gray-300">
                  {fromCurrency} Info
                </div>
                <div className="text-lg font-bold text-gray-900 dark:text-gray-100">
                  {currencyData[fromCurrency]?.name}{' '}
                  {currencyData[fromCurrency]?.flag}
                </div>
                <div className="text-sm text-gray-600 dark:text-gray-400">
                  {currencyData[fromCurrency]?.country}
                </div>
              </div>

              <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded border">
                <div className="text-sm font-medium text-gray-700 dark:text-gray-300">
                  {toCurrency} Info
                </div>
                <div className="text-lg font-bold text-gray-900 dark:text-gray-100">
                  {currencyData[toCurrency]?.name}{' '}
                  {currencyData[toCurrency]?.flag}
                </div>
                <div className="text-sm text-gray-600 dark:text-gray-400">
                  {currencyData[toCurrency]?.country}
                </div>
              </div>

              <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded border">
                <div className="text-sm font-medium text-gray-700 dark:text-gray-300">
                  Terakhir Diperbarui
                </div>
                <div className="text-lg font-bold text-gray-900 dark:text-gray-100">
                  {lastUpdated || new Date().toLocaleString('id-ID')}
                </div>
                <div className="text-sm text-gray-600 dark:text-gray-400">
                  Data real-time dari ExchangeRate-API
                </div>
              </div>
            </div>

            <div className="text-sm text-gray-600 dark:text-gray-400 mt-4">
              <p>
                <strong>Catatan:</strong> Nilai tukar diperbarui secara
                real-time.
                {error && ' Saat ini menggunakan data statis sebagai fallback.'}
              </p>
            </div>
          </div>
        )}
      </div>

      <div className="bg-white dark:bg-gray-800 p-6 rounded-lg border">
        <h4 className="text-lg font-medium mb-4 text-gray-800 dark:text-white">
          Mata Uang yang Didukung (
          {supportedCurrencies.length > 0
            ? supportedCurrencies.length
            : Object.keys(currencyData).length}
          )
        </h4>
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
          {(supportedCurrencies.length > 0
            ? currencyOptions.filter(option =>
                supportedCurrencies.includes(option.value)
              )
            : currencyOptions
          ).map(currency => (
            <div
              key={currency.value}
              className={`flex items-center p-2 rounded cursor-pointer transition-colors ${
                fromCurrency === currency.value || toCurrency === currency.value
                  ? 'bg-blue-100 dark:bg-blue-900 border border-blue-300 dark:border-blue-700'
                  : 'bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600'
              }`}
              onClick={() => {
                if (fromCurrency === currency.value) {
                  setToCurrency(currency.value);
                } else {
                  setFromCurrency(currency.value);
                }
              }}
            >
              <span className="font-medium mr-2">{currency.value}</span>
              <span className="text-sm text-gray-600 dark:text-gray-400 truncate">
                {currencyData[currency.value]?.flag}{' '}
                {currencyData[currency.value]?.name.split(' ')[0]}
              </span>
            </div>
          ))}
        </div>

        <div className="mt-4 text-sm text-gray-600 dark:text-gray-400">
          <p>
            <strong>Keterangan:</strong> Klik pada mata uang untuk mengaturnya
            sebagai mata uang asal.
          </p>
          <p className="mt-1">
            <strong>Sumber Data:</strong> Real-time exchange rates from
            ExchangeRate-API.
            {error && ' Fallback to static data when API is unavailable.'}
          </p>
        </div>
      </div>
    </div>
  );
}
